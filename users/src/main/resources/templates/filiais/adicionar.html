<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Adicionar Filial</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #666;
      --border: #333;
      --accent: #111;
      --success-bg: #dcfce7;
      --success-fg: #166534;
      --error-bg: #fee2e2;
      --error-fg: #991b1b;
    }
    .dark {
      --bg: #0f172a;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --border: #475569;
      --accent: #e5e7eb;
      --success-bg: #064e3b;
      --success-fg: #bbf7d0;
      --error-bg: #7f1d1d;
      --error-fg: #fecaca;
    }

    html, body { height: 100%; }
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    /* Header */
    header {
      border-bottom: 1px solid var(--border);
      padding: 12px 24px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .brand { font-weight: 700; letter-spacing: .3px; }
    nav a {
      color: var(--fg);
      text-decoration: none;
      border: 1px solid var(--border);
      padding: 6px 10px; border-radius: 8px; margin-left: 8px;
    }
    .toggle {
      margin-left: 12px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--fg);
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Conteúdo */
    main { flex: 1; padding: 24px; }
    form { max-width: 760px; }
    .field { margin-bottom: 12px; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    input { width:100%; padding:8px; box-sizing:border-box; border:1px solid var(--border); border-radius:8px; background:transparent; color:var(--fg); }
    .actions { margin-top:16px; display:flex; gap:8px; }
    .btn, .link { padding:8px 12px; border:1px solid var(--border); background:transparent; color:var(--fg); cursor:pointer; text-decoration:none; border-radius:8px; }
    .btn:hover, nav a:hover, .toggle:hover, .link:hover { filter: brightness(1.05); }
    .alert-success { background:var(--success-bg); color:var(--success-fg); padding:10px; border-radius:8px; margin:12px 0; }
    .alert-error { background:var(--error-bg); color:var(--error-fg); padding:10px; border-radius:8px; margin:12px 0; }

    /* Footer */
    footer {
      border-top: 1px solid var(--border);
      padding: 12px 24px;
      font-size: .95rem;
      color: var(--muted);
      display:flex; align-items:center; justify-content:space-between;
    }
    .dot {
      width: 8px; height: 8px; border-radius: 50%;
      margin-right: 8px; display:inline-block; background: #10b981; /* verde ok */
    }
    .dirty .dot { background: #f59e0b; } /* amarelo quando há alterações */
  </style>
</head>
<body>
<!-- HEADER: navegação + alternância de tema -->
<header>
  <div class="brand">MottuSense • Filiais</div>
  <div>
    <nav style="display:inline-block;">
      <a th:href="@{/filiaisview/listar}">Voltar</a>
      <a th:href="@{/usuariosview/listar}">Usuários</a>
    </nav>
    <button id="themeToggle" class="toggle" type="button" aria-label="Alternar tema">Tema</button>
  </div>
</header>

<main>
  <h1>Adicionar Filial</h1>

  <div class="alert-success" th:if="${sucesso} != null or ${param.sucesso} != null">
    <span th:text="${sucesso} ?: 'Filial cadastrada com sucesso'">Filial cadastrada com sucesso</span>
  </div>
  <div class="alert-error" th:if="${erro}" th:text="${erro}">Erro</div>

  <form id="formFilial" th:action="@{/filiaisview/salvar}" method="post" novalidate>
    <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />

    <div class="field">
      <label for="nomeFilial">Nome da filial</label>
      <input id="nomeFilial" type="text" name="nomeFilial" placeholder="Digite o nome da filial" autocomplete="off"/>
    </div>
    <div class="field">
      <label for="cep">CEP</label>
      <input id="cep" type="text" name="cep" placeholder="Somente números" autocomplete="off"/>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Salvar</button>
      <a class="link" th:href="@{/filiaisview/listar}">Cancelar</a>
    </div>
  </form>
</main>

<!-- FOOTER: ano atual + indicador de alterações não salvas -->
<footer id="footer">
  <div><span id="dirtyDot" class="dot"></span><span id="dirtyText">Sem alterações</span></div>
  <div>&copy; <span id="year"></span> MottuSense</div>
</footer>

<script>
  // === Tema (claro/escuro) com persistência ===
  (function () {
    const root = document.documentElement;
    const btn = document.getElementById('themeToggle');
    const saved = localStorage.getItem('theme') || 'light';
    if (saved === 'dark') root.classList.add('dark');
    btn.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
    });
  })();

  // === Footer: ano e indicador de "form dirty" + proteção de saída ===
  (function () {
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('formFilial');
    const footer = document.getElementById('footer');
    const dot = document.getElementById('dirtyDot');
    const text = document.getElementById('dirtyText');

    let isDirty = false;
    const markDirty = () => {
      if (!isDirty) {
        isDirty = true;
        footer.classList.add('dirty');
        text.textContent = 'Alterações não salvas';
      }
    };

    form.addEventListener('input', markDirty);
    form.addEventListener('change', markDirty);

    // ao enviar, não bloquear a navegação
    form.addEventListener('submit', () => { isDirty = false; });

    // alerta se tentar sair com alterações
    window.addEventListener('beforeunload', (e) => {
      if (isDirty) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  })();
</script>
</body>
</html>
