<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Editar Filial</title>
  <style>
    :root {
      --bg:#ffffff; --fg:#111; --muted:#666; --border:#333;
      --success-bg:#dcfce7; --success-fg:#166534;
      --error-bg:#fee2e2; --error-fg:#991b1b;
    }
    .dark {
      --bg:#0f172a; --fg:#e5e7eb; --muted:#9ca3af; --border:#475569;
      --success-bg:#064e3b; --success-fg:#bbf7d0;
      --error-bg:#7f1d1d; --error-fg:#fecaca;
    }

    html,body{height:100%}
    body{
      font-family:system-ui, Arial, sans-serif; margin:0; background:var(--bg); color:var(--fg);
      display:flex; flex-direction:column; min-height:100%;
    }

    /* Header */
    header{border-bottom:1px solid var(--border); padding:12px 24px; display:flex; align-items:center; justify-content:space-between;}
    .brand{font-weight:700;}
    nav a{color:var(--fg); text-decoration:none; border:1px solid var(--border); padding:6px 10px; border-radius:8px; margin-left:8px;}
    .toggle{margin-left:12px; border:1px solid var(--border); background:transparent; color:var(--fg); padding:6px 10px; border-radius:8px; cursor:pointer;}

    /* Main / form */
    main{flex:1; padding:24px;}
    form{max-width:760px;}
    .field{margin-bottom:12px;}
    label{display:block; font-weight:600; margin-bottom:6px;}
    input{width:100%; padding:8px; box-sizing:border-box; border:1px solid var(--border); border-radius:8px; background:transparent; color:var(--fg);}
    .actions{margin-top:16px; display:flex; gap:8px;}
    .btn, .link{padding:8px 12px; border:1px solid var(--border); background:transparent; color:var(--fg); cursor:pointer; text-decoration:none; border-radius:8px;}
    .muted{color:var(--muted);}
    .alert-success{background:var(--success-bg); color:var(--success-fg); padding:10px; border-radius:8px; margin:12px 0;}
    .alert-error{background:var(--error-bg); color:var(--error-fg); padding:10px; border-radius:8px; margin:12px 0;}
    .error{color:#b00020; font-size:.9rem; margin-top:4px;}

    /* Footer */
    footer{border-top:1px solid var(--border); padding:12px 24px; color:var(--muted); display:flex; align-items:center; justify-content:space-between;}
    .dot{width:8px; height:8px; border-radius:50%; margin-right:8px; display:inline-block; background:#10b981;}
    .dirty .dot{background:#f59e0b;}
    kbd{border:1px solid var(--border); border-bottom-width:2px; border-radius:4px; padding:0 6px; font-size:.85rem;}
  </style>
</head>
<body>
<!-- HEADER -->
<header>
  <div class="brand">MottuSense • Filiais</div>
  <div>
    <nav style="display:inline-block;">
      <a th:href="@{/filiaisview/listar}">Voltar</a>
      <a th:href="@{/usuariosview/listar}">Usuários</a>
    </nav>
    <button id="themeToggle" class="toggle" type="button" aria-label="Alternar tema">Tema</button>
  </div>
</header>

<main>
  <h1>Editar Filial</h1>

  <!-- Mensagens -->
  <div class="alert-success" th:if="${sucesso} != null or ${param.sucesso} != null">
    <span th:text="${sucesso} ?: 'Filial atualizada com sucesso'">Filial atualizada com sucesso</span>
  </div>
  <div class="alert-error" th:if="${erro}" th:text="${erro}">Erro</div>

  <p class="muted">ID: <span th:text="${idFilial}">id</span></p>

  <form id="formFilial"
        th:action="@{/filiaisview/atualizar/{id}(id=${idFilial})}"
        th:object="${filial}"
        method="post"
        novalidate>

    <!-- CSRF -->
    <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
    <!-- redundância segura -->
    <input type="hidden" name="idFilial" th:value="${idFilial}" />

    <!-- SOMENTE NOME DA FILIAL EDITÁVEL -->
    <div class="field">
      <label for="nomeFilial">Nome da filial</label>
      <input id="nomeFilial"
             type="text"
             th:field="*{nomeFilial}"
             placeholder="Digite o nome da filial"
             autocomplete="off" />
      <div class="error" th:if="${#fields.hasErrors('nomeFilial')}" th:errors="*{nomeFilial}"></div>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Atualizar</button>
      <a class="link" th:href="@{/filiaisview/listar}">Cancelar</a>
    </div>
  </form>
</main>

<!-- FOOTER -->
<footer id="footer">
  <div>
    <span class="dot" id="dirtyDot"></span>
    <span id="dirtyText">Sem alterações</span>
  </div>
  <div>
    • &copy; <span id="year"></span> MottuSense
  </div>
</footer>

<script>
  // Tema persistente
  (function(){
    const root = document.documentElement;
    const btn = document.getElementById('themeToggle');
    const saved = localStorage.getItem('theme') || 'light';
    if(saved === 'dark') root.classList.add('dark');
    btn.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
    });
  })();

  // Footer: ano + indicador de alterações + proteção de saída
  (function(){
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('formFilial');
    const footer = document.getElementById('footer');
    const text = document.getElementById('dirtyText');

    let dirty = false;
    const markDirty = () => {
      if (!dirty) {
        dirty = true;
        footer.classList.add('dirty');
        text.textContent = 'Alterações não salvas';
      }
    };

    form.addEventListener('input', markDirty);
    form.addEventListener('change', markDirty);
    form.addEventListener('submit', () => { dirty = false; });

    window.addEventListener('beforeunload', (e) => {
      if (dirty) { e.preventDefault(); e.returnValue = ''; }
    });
  })();
</script>
</body>
</html>
